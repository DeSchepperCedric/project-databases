{% extends "base.html" %}
{% block content %}
    <div class="row">
        <h1>{{ table.name }}</h1>
        <p>{{ table.desc }}</p>
    </div>
    <div class="row">
        <div class="col-sm-2">
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="collapse"
                           data-parent="#accordion"
                           href="#collapseOne"><i class="fas fa-list-ul"></i> Row transformations</a>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <table class="table">
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal" data-target="#addRow"
                                           href="#addRow"><i class="fas fa-plus-square"></i>
                                        Add row</a></td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" id="removeRow" href="#"><i
                                            class="fas fa-minus-circle"></i>
                                        Remove selected row(s)</a></td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#removePredicate" href="#removePredicate"><i
                                            class="fas fa-minus-circle"></i>
                                        Remove by predicate</a></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a data-toggle="collapse" data-parent="#accordion"
                           class="btn btn-dark panel-button"
                           href="#collapseTwo"><i class="fas fa-columns"></i>
                            Column transformations</a>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse">
                        <div class="panel-body">
                            <table class="table">
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#addColumn"
                                           href="#addColumn"><i class="fas fa-plus-square"></i> Add column</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#deleteColumn" href="#deleteColumn"><i
                                            class="fas fa-minus-circle"></i> Delete column</a></td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#updateColumn" href="#updateColumn"><i
                                            class="fas fa-edit"></i> Change column type</a></td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#renameColumnModal" href="#renameColumnModal"><i
                                            class="fas fa-edit"></i> Rename column</a></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a data-toggle="collapse" data-parent="#accordion"
                           class="btn btn-dark panel-button"
                           href="#collapseThree"><i class="fas fa-chart-bar"></i>
                            Numerical transformations</a>
                    </div>
                    <div id="collapseThree" class="panel-collapse collapse">
                        <div class="panel-body">
                            <table class="table">
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#normalizeModal"
                                           href="#normalizeModal"><i class="fas fa-align-center"></i> Normalize</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#discretizeModal" href="#discretizeModal"><i
                                            class="fas fa-chart-bar"></i> Discretize</a></td>
                                </tr>
                                <tr>
                                    <td><a class="btn btn-light panel-button" data-toggle="modal"
                                           data-target="#outlierModal" href="#outlierModal"><i
                                            class="fas fa-filter"></i> Remove outliers</a></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#DateTimeTransformations"
                           href="#DateTimeTransformations"><i class="fas fa-clock"></i> Date/Time transformations</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" id="history" href="#"><i class="fas fa-history"></i>
                            History</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#ImputeMissingData"
                           href="#ImputeMissingData"><i class="fas fa-syringe"></i> Fill empty data</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#askStats"
                           href="#askStats"><i class="fas fa-pie-chart"></i> Statistics</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#rawData"
                           href="#rawData"><i class="fas fa-undo"></i> Raw data</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#exportOptions"
                           href="#exportOptions"><i class="fas fa-file-code"></i> Export</a>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <a class="btn btn-dark panel-button" data-toggle="modal" data-target="#findAndReplace"
                           href="#findAndReplace"><i class="fas fa-search"></i> Find and replace</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-10">
            <table class="table table-striped table-bordered table-responsive-sm" cellspacing="0" width="100%"
                   id="dataTable">
                <thead>
                <tr>
                    <th class="scrolling-disabled"></th>
                    {% for column in table.columns[1:] %}

                        <th>
                            {{ column.name|capitalize }}
                        </th>
                    {% endfor %}
                </tr>
                </thead>
            </table>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="addRow">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" method="post" id="formAddRow">
                        <div class="modal-header">
                            <h5 class="modal-title">Add row</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            {% for column in table.columns[1:] %}
                                <label for="value-col-{{ column.name }}">{{ column.name|capitalize }}</label>
                                <input type="text" class="form-control" name="value-col-{{ column.name }}"
                                       id="value-col-{{ column.name }}">
                            {% endfor %}
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="addColumn">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formAddColumn">
                        <div class="modal-header">
                            <h5 class="modal-title">Add column</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="col-name">Column name</label>
                            <input type="text" class="form-control" name="col-name" id="col-name">
                            <label for="col-type">Column type</label>
                            <select class="form-control" name="col-type" id="col-type">
                                <option value="INT">INTEGER</option>
                                <option value="DOUBLE PRECISION">DOUBLE</option>
                                <option value="TIMESTAMP">DATE/TIME</option>
                                <option value="VARCHAR(255)">STRING</option>
                                <option value="BIT">BIT</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="deleteColumn">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formDeleteColumn">
                        <div class="modal-header">
                            <h5 class="modal-title">Delete column</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="col-name">Column</label>
                            <select class="form-control" name="col-name" id="col-name">
                                {% for column in table.columns[1:] %}
                                    <option value="{{ column.name }}">{{ column.name|capitalize }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="updateColumn">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formUpdateColumn">
                        <div class="modal-header">
                            <h5 class="modal-title">Update column type</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="col-name">Column</label>
                            <select class="form-control" name="col-name" id="col-name">
                                {% for column in table.columns[1:] %}
                                    <option value="{{ column.name }}">{{ column.name|capitalize }}
                                        ({{ column.type|capitalize }})
                                    </option>
                                {% endfor %}
                            </select>
                            <label for="col-type">Column type</label>
                            <select class="form-control" name="col-type" id="col-type">
                                <option value="INT">INTEGER</option>
                                <option value="DOUBLE PRECISION">DOUBLE</option>
                                <option value="TIMESTAMP">DATE/TIME</option>
                                <option value="VARCHAR(255)">STRING</option>
                                <option value="BIT">BIT</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="DateTimeTransformations">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formDateTimeTransformations">
                        <div class="modal-header">
                            <h5 class="modal-title">Time/Date transformations</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="col-name">Column</label>
                            <select class="form-control" name="col-name" id="col-name">
                                {% for column in table.columns[1:] %}
                                    {% if (column.type == "timestamp") %}
                                        <option value="{{ column.name }}">{{ column.name|capitalize }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>

                            <label for="transformation-name">Transformation</label>
                            <select id="operation-name" class="form-control" name="operation-name">
                                {% for transformation in time_date_transformations %}
                                    <option value="{{ transformation }}">
                                        {{ transformation }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="ImputeMissingData">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formImputeMissingData">
                        <div class="modal-header">
                            <h5 class="modal-title">Impute missing data</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="col-name">Column</label>
                            <select class="form-control" name="col-name" id="col-name">
                                {% for column in table.columns[1:] %}
                                    {% if ((column.type == "real") or (column.type == "double") or (column.type == "integer")) %}
                                        <option value="{{ column.name }}">{{ column.name|capitalize }}
                                            ({{ column.type|capitalize }})
                                        </option>
                                    {% endif %}
                                {% endfor %}
                            </select>

                            <label for="function">Based on</label>
                            <select id="function" class="form-control" name="function">
                                <option value="AVG">AVERAGE</option>
                                <option value="MEDIAN">MEDIAN</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save changes
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="exportOptions">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-group" id="formExportOptions">
                        <div class="modal-header">
                            <h5 class="modal-title">Export table</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <label for="separator">Separator</label>
                            <input type="text" class="form-control" name="separator" id="separator"
                                   placeholder="Separator">

                            <label for="quote">Quote character</label>
                            <input type="text" class="form-control" name="quote_char" id="quote_char"
                                   placeholder="Quote character">

                            <label for="empty-char">Empty character</label>
                            <input type="text" class="form-control" name="empty_char" id="empty_char"
                                   placeholder="Empty character">

                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Done</button>
                            <a href="/api/download/{{ table.name }}.csv" id="exportDLBtn" download
                               style="display:none"></a>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="rawData">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"> Raw data</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formRevertRawData">
                            <div class="form-group">
                                <h6>Revert to raw data</h6>
                                <button type="submit" class="btn btn-primary" {% if not raw_table_exists %}
                                        disabled  {% endif %}>Revert
                                </button>
                            </div>
                        </form>
                        <form id="formShowRawData">
                            <div class="form-group">
                                <h5 class="modal-title">Show raw data</h5>
                                <button type="submit" class="btn btn-primary" {% if not raw_table_exists %}
                                        disabled  {% endif %}>Show
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="askStats">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <form class="form-group" id="formAskStats">
                    <div class="modal-header">
                        <h5 class="modal-title">Statistics</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body form-group">
                        <label for="stat-column-selector">Column</label>
                        <select class="custom-select" name="col-name" id="stat-column-selector">
                            <option value="Default" selected>Choose column</option>
                            {% for column in table.columns[1:] %}
                                <option value="{{ column.name }}"
                                        data-type="{{ column.type }}">{{ column.name|capitalize }}</option>
                            {% endfor %}
                        </select>
                        <canvas id="chart" width="600" height="400" style="" data-column></canvas>
                        <script>
                            var ctx = $('#chart');
                            var chart = new Chart(ctx, {});

                            function randomColorGenerator(count) {
                                var data = [];
                                for (var i = 0; i < count; i++) {
                                    data.push('#' + (Math.random().toString(16) + '0000000').slice(2, 8));
                                }
                                return data;
                            }

                            function createChart(data) {
                                console.log(randomColorGenerator());
                                chart = new Chart(ctx, {
                                    type: data.chart,
                                    data: {
                                        labels: data.labels,
                                        datasets: [{
                                            label: data.label,
                                            data: data.data,
                                            backgroundColor: randomColorGenerator(data.labels.length)
                                        }]
                                    }
                                })

                            }

                            function updateChart() {
                                data = {
                                    'col-name': $('#stat-column-selector').val(),
                                    'col-type': $('option:selected', '#stat-column-selector').data('type')
                                };
                                console.log(data)
                                $.ajax({
                                    url: '/api' + window.location.pathname + '/chart?' + $.param(data),
                                    success: function (data) {
                                        console.log(data);
                                        chart.destroy();
                                        createChart(data);
                                    }
                                })
                            }
                        </script>
                        {% for col_stats in statistics %}
                            {% for stat in col_stats[1] %}
                                <div>
                                    <label for="value" id="{{ col_stats[0] }}" class="{{ col_stats[0] }} stats"
                                           style="display:none">
                                        {{ stat[0] }}
                                    </label>
                                    <input id="value" class="{{ col_stats[0] }} stats form-control"
                                           value="{{ stat[1] }}" style="display:none" readonly>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="normalizeModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-group" id="formNormalizeModal">
                    <div class="modal-header">
                        <h5 class="modal-title">Normalize data</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <label for="col-name">Column</label>
                        <select class="form-control" name="col-name" id="col-name">
                            {% for column in table.columns[1:] %}
                                {% if ((column.type == "real") or (column.type == "double") or (column.type == "integer")) %}
                                    <option value="{{ column.name }}">{{ column.name|capitalize }}
                                        ({{ column.type|capitalize }})
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Normalize
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="discretizeModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-group" id="formDiscretizeModal">
                    <div class="modal-header">
                        <h5 class="modal-title">Normalize data</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <label for="col-name">Column</label>
                        <select class="form-control" name="col-name" id="col-name">
                            {% for column in table.columns[1:] %}
                                {% if ((column.type == "real") or (column.type == "double") or (column.type == "integer")) %}
                                    <option value="{{ column.name }}">{{ column.name|capitalize }}
                                        ({{ column.type|capitalize }})
                                    </option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <label for="discretization">Option</label>
                        <select class="form-control" name="discretization" id="discretization"
                                onchange="displayOnSelect(this);">
                            <option value="eq-width" selected>Equal width ranges</option>
                            <option value="eq-freq">Equal frequency ranges</option>
                            <option value="manual">Manual ranges</option>
                        </select>
                        <div class="show-when-discretization select-eq-width select-eq-freq" style="display: none;">
                            <label for="num-intervals">Number of intervals</label>
                            <input name="num-intervals" id="num-intervals" class="form-control"
                                   aria-describedby="numIntervalsHelpBlock">
                            <small id="numIntervalsHelpBlock" class="form-text text-muted">
                                Choose the amount of intervals you want
                            </small>
                        </div>
                        <div class="show-when-discretization select-manual" style="display: none;">
                            <label for="intervals">Ranges</label>
                            <input name="intervals" id="intervals" class="form-control"
                                   aria-describedby="intervalsHelpBlock">
                            <small id="intervalsHelpBlock" class="form-text text-muted">
                                Define a range [a, b), [b, c) as follows: a, b, c
                            </small>
                        </div>
                        <script>
                            function displayOnSelect(select) {
                                $('.show-when-' + select.id).hide();
                                $('.select-' + select.value).show();
                            }
                        </script>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Discretize
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="renameColumnModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-group" id="formRenameColumn">
                    <div class="modal-header">
                        <h5 class="modal-title">Change column name</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <label for="col-name">Column</label>
                        <select class="form-control" name="col-name" id="col-name">
                            {% for column in table.columns[1:] %}
                                <option value="{{ column.name }}">{{ column.name|capitalize }}</option>
                            {% endfor %}
                        </select>

                        <label for="col-type">New name</label>
                        <input class="form-control" name="new-name" id="new-name">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Rename</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="outlierModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-group" id="formOutlierModal">
                    <div class="modal-header">
                        <h5 class="modal-title">Remove outliers</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group col">
                            <label for="col-name">Column</label>
                            <select class="custom-select" name="col-name" id="col-name">
                                {% for column in table.columns[1:] %}
                                    {% if ((column.type == "real") or (column.type == "double") or (column.type == "integer")) %}
                                        <option value="{{ column.name }}">{{ column.name|capitalize }}
                                            ({{ column.type|capitalize }})
                                        </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="col">
                                <label for="option">Option</label>
                                <select class="custom-select" name="option" id="option">
                                    <option value="less-than" selected>Less than</option>
                                    <option value="more-than">More than</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="value">Value</label>
                                <input class="form-control" name="value" id="value">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Remove outliers
                            </button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="removePredicate">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <form action="/datasets/{{ current_user.active_schema }}/tables/{{ table.name }}/remove-rows"
                      method="post"
                      class="form-inline" id="formRemovePredicate">
                    <div class="modal-header">
                        <h5 class="modal-title">Remove rows</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body form-group">
                        <div data-dynamic-form>
                            <div data-dynamic-form-template="multi">
                                <select class="form-control" form="formRemovePredicate" name="join[ID]"
                                        data-dynamic-form-input-id-template="ID"
                                        id="join[ID]-AndOr">
                                    <option value="AND">AND</option>
                                    <option value="OR">OR</option>
                                </select>
                                <select class="form-control" form="formRemovePredicate" name="join[ID]"
                                        data-dynamic-form-input-id-template="ID"
                                        id="join[ID]-column">
                                    {% for column in table.columns[1:] %}
                                        <option value="{{ column.name }}">{{ column.name|capitalize }}</option>
                                    {% endfor %}
                                </select>
                                <select class="form-control" form="formRemovePredicate" name="join[ID]"
                                        data-dynamic-form-input-id-template="ID"
                                        id="join[ID]-condition">
                                    <option value="=">equals</option>
                                    <option value="<>">doesn't equal</option>
                                    <option value="<">less than</option>
                                    <option value="<=">less or equals</option>
                                    <option value=">">more than</option>
                                    <option value=">=">more than or equals</option>
                                    <option value="CONTAINS">contains</option>
                                </select>
                                <input class="form-control" form="formRemovePredicate" name="join[ID]"
                                       data-dynamic-form-input-id-template="ID"
                                       id="join[ID]-value">

                                <button class="btn btn-secondary" type="button" data-dynamic-form-remove>Remove
                                </button>
                                <button class="btn btn-primary" type="button" data-dynamic-form-add>Add</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Delete</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" aria-hidden="true" id="findAndReplace">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-group" id="formFindAndReplace">
                    <div class="modal-header">
                        <h5 class="modal-title">Find and replace</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <label for="replace-column-selector">Column</label>
                        <select class="form-control" name="col-name" id="replace-column-selector">
                            <option value="Default" selected="selected">Choose column...
                            </option>
                            {% for column in table.columns[1:] %}
                                <option value="{{ column.name }}"
                                        data-type="{{ column.type }}">{{ column.name|capitalize }}
                                </option>
                            {% endfor %}
                        </select>
                        <label for="replace-function-selector">Replacement type</label>
                        <select class="form-control" name="replacement-function" id="replace-function-selector">
                            <option value="Default" selected="selected">Choose replacement type...
                            </option>
                            <option value="substring" class="textOnly">Substring</option>
                            <option value="full replace">Full replace</option>
                            <option value="regex" class="textOnly">Regex</option>
                        </select>
                        <label for="value-to-be-replaced" class="noRegex" style="display:none;">Replace</label>
                        <input class="form-control noRegex" name="value-to-be-replaced" id="value-to-be-replaced"
                               style="display:none;">
                        <label for="replacement-regex " class="regex" style="display:none;">Regex</label>
                        <input class="form-control regex" name="replacement-regex" id="replacement-regex"
                               style="display:none">
                        <label for="replacement-value" class="regexAndNoRegex" style="display:none;">Replace
                            with</label>
                        <input class="form-control regexAndNoRegex" name="replacement-value" id="replacement-value"
                               style="display:none">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Replace</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function () {
                var table = $('#dataTable').DataTable({
                    scrollX: "auto",
                    scrollY: "50vh",
                    scrollCollapse: true,
                    processing: true,
                    serverSide: true,
                    ajax: '/api' + window.location.pathname,
                    order: [[1, 'desc']],
                    rowsDefs: [{}],
                    columnDefs: [{
                        targets: 0,
                        searchable: false,
                        orderable: false,
                        width: '1%', // min width
                        render: function (data) {
                            return '<input type="checkbox" class="form-check" name="row-' + data + '" id="row-' + data + '">';
                        }
                    }]
                });

                $('#removeRow').click(function () {
                    $.ajax({
                        type: 'DELETE',
                        url: '/api' + window.location.pathname + '/rows?' + $('input:checked').serialize(),
                        contentType: 'application/json;charset=UTF-8',
                        success: function () {
                            window.location.reload();
                        }
                    })
                });
                $('#formAddRow').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'POST',
                        url: '/api' + window.location.pathname + '/rows?' + $('#formAddRow').serialize(),
                        success: function () {
                            table.ajax.reload();
                        }
                    });
                    $('#addRow').modal('hide');
                });
                $('#formAddColumn').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'POST',
                        url: '/api' + window.location.pathname + '/columns?' + $('#formAddColumn').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#addColumn').modal('hide');
                });
                $('#formDeleteColumn').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'DELETE',
                        url: '/api' + window.location.pathname + '/columns?' + $('#formDeleteColumn').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#deleteColumn').modal('hide');
                });
                $('#formUpdateColumn').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/columns?' + $('#formUpdateColumn').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#updateColumn').modal('hide');
                });
                $('#formDateTimeTransformations').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/date-time-transformations?' + $('#formDateTimeTransformations').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#formDateTimeTransformations').modal('hide');
                });
                $('#formImputeMissingData').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/impute-missing-data?' + $('#formImputeMissingData').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#formImputeMissingData').modal('hide');
                });

                $('#stat-column-selector').change(function () {
                    updateChart();
                    $('.stats').hide();
                    var string = "";
                    var words = $(this).val().split(" ");
                    for (var i = 0; i < words.length; i++) {
                        string = string + "." + words[i];
                    }
                    console.log(string);
                    $(string).show();
                    $('#askStats').modal('handleUpdate');
                });

                $('#replace-column-selector').change(function () {
                    if ($(this).find(':selected').data('type') != "text") {
                        $('.textOnly').hide();
                    }
                    else {
                        $('.textOnly').show();
                    }
                });


                $('#replace-function-selector').change(function () {
                    if ($(this).val() == "regex") {
                        $('.noRegex').hide();
                        $('.regex').show();
                        $('.regexAndNoRegex').show();
                    }
                    else if (($(this).val() == "substring") || ($(this).val() == "full replace")) {
                        $('.noRegex').show();
                        $('.regex').hide();
                        $('.regexAndNoRegex').show();
                    }
                    else {
                        $('.noRegex').hide();
                        $('.regex').hide();
                        $('.regexAndNoRegex').hide();
                    }
                });

                $('#formRevertRawData').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: window.location.pathname + '/revert-to-raw-data'
                    });
                    // window.location.reload();
                });

                $('#formShowRawData').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'GET',
                        url: window.location.pathname + '/show-raw-data'
                    });
                    window.location.assign(window.location.pathname + '/show-raw-data')
                });

                $('#formNormalizeModal').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/normalize?' + $('#formNormalizeModal').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                });

                $('#formDiscretizeModal').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/discretize?' + $('#formDiscretizeModal').serialize(),
                        success: function () {
                            window.location.reload();
                        },
                        error: function (response) {
                            console.log(response.responseJSON.message);
                        }
                    });
                });

                $('#formOutlierModal').submit(function (e) {
                    e.preventDefault();
                    console.log($('#formOutlierModal').serialize());
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/outliers?' + $('#formOutlierModal').serialize(),
                        success: function () {
                            window.location.reload();
                        },
                        error: function (response) {
                            console.log(response.responseJSON.message);
                        }
                    });
                });

                $('#formRenameColumn').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/rename-column?' + $('#formRenameColumn').serialize(),
                        success: function () {
                            window.location.reload();
                            $('#formRenameColumn').modal('hide');
                        }
                    });
                });

                $('#formFindAndReplace').submit(function (e) {
                    e.preventDefault();
                    $.ajax({
                        type: 'PUT',
                        url: '/api' + window.location.pathname + '/find-and-replace?' + $('#formFindAndReplace').serialize(),
                        success: function () {
                            window.location.reload();
                        }
                    });
                    $('#formFindAndReplace').modal('hide');
                });

                $('#history').click(function (e) {
                    e.preventDefault();
                    window.location.href = window.location.pathname + '/history';
                });
            }
        );
    </script>
    </div>
{% endblock %}
