{% extends "base.html" %}
{% block content %}
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">
            <h1>{{ ds.name }}</h1>
            <p>{{ ds.desc }}</p>
        </div>
        <div class="col-sm-2"></div>
    </div>

    {% if tables|length > 0 %}
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <table id="tablesOverview" class="display table table-striped table-bordered" cellspacing="0"
                       width="100%">
                    <thead>
                    <tr>
                        <th>Table</th>
                        <th>Description</th>
                        <th style="text-align: center;">Remove</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for t in tables %}
                        <tr>
                            <td><a href="/datasets/{{ ds.id }}/tables/{{ t.name }}">{{ t.name }}</a></td>
                            <td> {{ t.desc }}</td>
                            <td style="text-align: center;">
                                <form action="/datasets/{{ ds.id }}/tables/{{ t.name }}/delete" method="post">
                                    <button type="submit" class="btn btn-xs btn-danger">❌
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-sm-2">
                {% if ((current_user.username in ds.moderators) or (current_user.username == ds.owner)) %}
                <div class="col-sm-4">
                    <h4>Dataset access</h4>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#accessModal">
                      Manage access
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="accessModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel"
                         aria-hidden="true">
                      <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalLabel">'{{ds.name}}' access</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Actual users table -->
                            <table id="userTable" class="display table table-striped table-bordered" cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Role</th>
                                        <th>Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <!-- TODO: Fill table with other mods / contributers properly
                                {% for user in users %}
                                    <tr>
                                        <td>{{ user.username }}</td>
                                        <td>{{ user.firstname }}</td>
                                        <td>{{ user.lastname }}</td>
                                        <td>{{ user.email }}</td>
                                        <td>{{ user.status }}</td>
                                        <td style="text-align: center;"><input id="{{ user.username }}"
                                                                               name="{{ user.username }}"
                                                                               {% if user.is_active %}checked{% endif %}
                                                                               type="checkbox" class="form-check-input"></td>
                                        <td style="text-align: center;">
                                            <form action="/admin_page/{{ user.username }}/delete" method="post">
                                                <button type="submit" class="btn btn-xs btn-danger" {% if user.status == 'admin' %}disabled{% endif %}>
                                                    ❌
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                                -->
                                </tbody>
                            </table>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary">Save</button>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    {% endif %}

    <div class="row" style="margin-top: 10px;">
        <div class="col-sm-4"></div>
        <div class="col-sm-4">
            <h4>Add CSV/Zip</h4>
            <form action="/datasets/{{ ds.id }}" method="post" enctype=multipart/form-data>
                <input type="file" name="file" id="ds-files" accept=".csv,.zip,.dump" style='margin-bottom: 10px;'>
                <br>
                <button type="submit" class="btn btn-default" id="submit">Submit</button>
            </form>
        </div>
    </div>
    <br>
{% endblock %}